#Direct memory access controller(DMA控制器)  
DMA用于在外设和内存、内存和内存之间，提供高速数据传输。Data可以通过DMA快速传输，而不需要CPU干预；为其他操作节省了CPU资源。  
DMA控制器有5个通道，每个通道专门用来管理来自一个或多个外设的内存访问请求。还有一个仲裁器处理DMA请求的优先级。  
##DMA的主要特性  
- 5个独立可配置的DMA通道（请求）  
- 每个通道连接专门的硬件DMA请求或软件触发，由软件进行配置。  
- DMA请求的优先级可由软件设置（4级：很高，高，中，低），在优先级相等时，由硬件决定（请求1优先级高于请求2，以此类推）。  
- 源和目标的传输数据宽度（字节，半字，字）是独立，如果不同，DMA会把数据打包或拆开，以满足目标要求的数据宽度。源/目标地址必须按传输数据宽度对齐。  
- 支持循环缓冲区管理  
- 每个通道有3个事件标志（DMA半传输，DMA传输完成和DMA传输错误），它们按逻辑或成一个中断请求。  
- 内存间传输  
- 外设和内存间传输，外设间传输  
- 外设可以作为源或目标访问   
- 可编程的数据传输个数：最大65535  
##DMA功能描述  
![](https://i.imgur.com/a4zzoQc.png)  
DMA控制器通过和ARM Cortex-M0内核共享系统总线，执行直接内存传输。当CPU和DMA访问同样的目标（内存或外设）时，DMA请求可能会在几个总线周期内暂停CPU访问系统总线。总线矩阵实现循环调度，以确保CPU至少有一半系统总线宽度。  
####DMA处理  
发生一个事件后，外设向DMA控制器发送请求。DMA控制器根据通道优先级处理请求。当DMA控制器访问发送请求的外设时，DMA控制器会发送一个应答信号给这个外设。当这个外设收到DMA控制器的应答后，立马释放请求。一旦外设释放请求，DMA控制器也会撤销应答。如果有多个请求，那么外设就可以启动下个处理。  
总的来说，每个DMA传输包含3组操作：  
- 从外设数据寄存器或当前外设/内存地址寄存器所指内存地址，取数据。在DMA_CPARx或DMA_CMARx寄存中编写的外设/内存地址，作为第一次传输的起始地址。  
- 存储，从外设数据寄存器或当前外设/内存地址寄存器所指内存地址，取得的数据。在DMA_CPARx或DMA_CMARx寄存中编写的外设/内存地址，作为第一次传输的起始地址。  
- DMA_CNDTRx寄存器存放需要执行的处理个数，完成一次处理，其值减1。  
