# Universal synchronous asynchronous receiver transmitter (USART)  
## 简介  
通用同步异步收发器（USART）提供了一种灵活的方式，与要求工业标准NRZ异步串行数据格式的外部设备进行全双工数据交换。USART使用可编程波特率发生器，提供很宽范围的波特率。  
它支持同步单向通信和半双工单线通信，以及多处理器通信。它也支持Modem调制解调器流控操作（CTS/RTS）。  
使用DMA（直接存储器存取）配置多个缓冲区，可以实现高速数据通信。  
## USART主要特性  
- 全双工异步通信  
- NRZ标准格式（mark标记/space空格）  
- 配置16倍或8倍过采样，提供速度和时钟公差之间灵活的选择  
- 当时钟频率时48MHz，且采用8倍过采样率时，通用可编程收发波特率可以达到6Mbit/s  
- 方便的波特率编程  
- 自动波特率检测  
- 可编程的数据字长（8位或9位）  
- 可编程的数据顺序，MSB最高位或LSB最低位在前  
- 可配置的停止位（1或2个停止位）  
- 用于同步通信的同步模式和时钟输出  
- 单线半双工通信  
- 使用DMA实现连续通信  
- 使用DMA将收到/发送的字节缓存到预留的SRAM区域中  
- 分开的发送和接收使能位  
- 分开的发送和接收信号极性控制  
- 可交换的Tx/Rx引脚配置  
- 用于Modem调制解调器和RS-485收发器的硬件流控制  
- 通信控制/错误检测标志  
- 奇偶校验控制：  
　- 发送奇偶校验位  
　- 检查接收的数据字节的奇偶性  
- 十四个具有标志位的中断源  
- 多处理器通信  
- 如果地址不匹配，USART进入静默模式  
- 从静默模式唤醒（检测到线路空闲或地址匹配标记）  
## USART配备  
![](https://i.imgur.com/rwosfMn.png)  
![](https://i.imgur.com/9fcdvIG.png)  
## USART功能描述  
任何USART双向通信都需要至少2个引脚：RX接收数据和TX发送数据：  
- RX：接收数据输入引脚。过采样技术用于数据恢复，通过鉴别有效的输入数据和噪声。  
- TX：发送数据输出引脚。当发送器关闭时，该输出引脚回到其I/O口配置状态。当发送器启动，但未发送数据时，TX引脚是高电平。在单线模式，该I/O口用作发送和接收数据。  
正常USART模式下，串行数据通过这些引脚发送和接收。数据帧由以下组成：  
- 发送或接收前保持线路空闲  
- 一个起始位  
- 一个数据字（8位或9位），最低有效位在前  
- 1个或2个停止位，指示帧结束  
- USART接口使用波特率发生器  
- 一个状态寄存器USART_ISR  
- 接收和发送数据寄存器USART_RDR和USART_TDR  
- 一个波特率寄存器USART_BRR  
下面的引脚在同步模式下需要：  
- CK：时钟输出。该引脚为同步发送，输出发送数据时钟，类似于SPI主模式（起始位和停止位没有时钟脉冲，最后一位数据软件可选是否发送时钟脉冲）。同时，RX可以同步接收数据。这可以用于控制带移位寄存器的外设。时钟相位和极性可由软件编程。  
下列引脚用于RS232硬件流控制模式：  
- CTS：当高电平时，在当前发送结束后阻止数据发送  
- RTS：低电平，指示USART准备好接收数据  
下面的引脚用于RS485硬件控制模式：  
- DE：驱动器使能，用于激活外部收发器的发送模式  
注：DE和RTS共享同一个引脚。  
![](https://i.imgur.com/y7GnxBD.png)  
### USART字符说明  
通过USART_CR1寄存器中的M位（第12bit：M0），可以编程选择8位或9位字长。  
- 8位字符长度：M0=0  
- 9位字符长度：M0=1  
默认情况下，TX和RX信号在起始位时为低电平，而在停止位时为高电平。  
通过极性配置控制，可以分别对TX或RX的这些值取反。  
空闲字符可以理解为整个帧每一位都为1。  
断开字符可以理解为每一位都为0的帧。在断开帧的结尾，发送器会插入2个停止位。  
发送器和接收器有共同的波特率发生器驱动，发送和接收各自的使能位置1后，将为其产生时钟。  
![](https://i.imgur.com/LCrh5yZ.png)  
![](https://i.imgur.com/2ZZr5n5.png)  
注：这两幅图有差异，感觉第2幅图才是正确的，符合断开字符的描述。  
### USART发送器  
